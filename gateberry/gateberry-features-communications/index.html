
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Industrial Shield PLCs and related hardware.">
      
      
        <meta name="author" content="Industrial Shield">
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../gateberry-expansion/">
      
      
      <link rel="icon" href="../../assets/industrial-shields/logo.webp">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Features & Communications - Industrial Shields Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../custom/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#GateBerry---Features--Communications" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Industrial Shields Documentation" class="md-header__button md-logo" aria-label="Industrial Shields Documentation" data-md-component="logo">
      
  <img src="../../assets/industrial-shields/logo.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Industrial Shields Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Features & Communications
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Industrial Shields Documentation" class="md-nav__button md-logo" aria-label="Industrial Shields Documentation" data-md-component="logo">
      
  <img src="../../assets/industrial-shields/logo.webp" alt="logo">

    </a>
    Industrial Shields Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Devices Family
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Devices Family
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    GateBerry
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            GateBerry
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Features & Communications
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Features & Communications
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#RS485" class="md-nav__link">
    <span class="md-ellipsis">
      RS485
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#I²C" class="md-nav__link">
    <span class="md-ellipsis">
      I²C
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RTC" class="md-nav__link">
    <span class="md-ellipsis">
      RTC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#UPS" class="md-nav__link">
    <span class="md-ellipsis">
      UPS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#Expansion-Boards" class="md-nav__link">
    <span class="md-ellipsis">
      Expansion Boards
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateberry-expansion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expansion Boards
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#RS485" class="md-nav__link">
    <span class="md-ellipsis">
      RS485
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#I²C" class="md-nav__link">
    <span class="md-ellipsis">
      I²C
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#RTC" class="md-nav__link">
    <span class="md-ellipsis">
      RTC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#UPS" class="md-nav__link">
    <span class="md-ellipsis">
      UPS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#Expansion-Boards" class="md-nav__link">
    <span class="md-ellipsis">
      Expansion Boards
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="GateBerry---Features--Communications">GateBerry - Features &amp; Communications<a class="headerlink" href="#GateBerry---Features--Communications" title="Permanent link">&para;</a></h1>
<h2 id="RS485">RS485<a class="headerlink" href="#RS485" title="Permanent link">&para;</a></h2>
<p>RS485 is a serial communication standard that allows data transmission over long distances and between multiple devices using a single pair of wires. It is resistant to electrical noise and commonly used in industrial environments.</p>
<h3 id="Important-features-and-values-to-consider">Important features and values ​​to consider<a class="headerlink" href="#Important-features-and-values-to-consider" title="Permanent link">&para;</a></h3>
<table>
   <tr><td><b>Interface type</b></td><td>RS-485 half-duplex</td></tr>
   <tr><td><b>Communication speed (baud rate)</b></td><td><a href="#1-Serial-Port-Configuration">Configurable</a></td></tr>
   <!-- <tr><td><b>Protocolos compatibles</b></td><td>Modbus RTU</td></tr> -->
   <!-- <tr><td><b>Voltage and signal levels:</b></td><td>aaaa</td></tr> -->
   <tr><td><b>Connectors and wiring</b></td><td>Push-in connectors (<b>A</b>(+) and <b>B</b>(-))</td></tr>
   <tr><td><b>Termination resistor</b></td><td>120 ohms (<a href="#4-Termination-Resistor-Configuration">software configurable</a>)</td></tr>
</table>

<div class="admonition success">
<p class="admonition-title">Recommendation</p>
<p>It's recommended to use twisted pair to minimize electromagnetic interference (EMI). <br />
  If you're in a noisy environment, use shielded twisted pair (STP).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The PLC is able to enable and disable the built-in 120 ohm termination resistor by software, to activate it if you are at one end of the bus and avoid the reflection of the signals.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Communication status management is not automatic. The sending/receiving status must be managed manually, controlling the DE/RE pin connected to <strong>GPIO 27</strong></p>
</div>
<h3 id="Connections">Connections<a class="headerlink" href="#Connections" title="Permanent link">&para;</a></h3>
<figure style="padding: 50px">
  <img alt="" src="../../assets/pinout-diagrams/gateberry_ps-gateberry-rs485bus.svg" width="70%" />
    <!-- <figcaption>Image caption</figcaption> -->
</figure>
<h3 id="Configurations">Configurations<a class="headerlink" href="#Configurations" title="Permanent link">&para;</a></h3>
<p>The GateBerry PLC provides an RS485 communication interface connected to the serial port <code>/dev/rs485</code>.
The following instructions describe how to configure and use this interface for both data transmission and reception.</p>
<h4 id="1-Serial-Port-Configuration">1. Serial Port Configuration<a class="headerlink" href="#1-Serial-Port-Configuration" title="Permanent link">&para;</a></h4>
<p>Before starting communication, the serial port baud rate must be configured.
Ensure that this baud rate matches the one used on the RS485 network.</p>
<p><strong>For example</strong>: To set the baud rate to <code>38400</code> bps, run:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>stty<span class="w"> </span>-F<span class="w"> </span>/dev/rs485<span class="w"> </span><span class="m">38400</span>
</span></code></pre></div>
<h4 id="2-Receiving-Messages">2. Receiving Messages<a class="headerlink" href="#2-Receiving-Messages" title="Permanent link">&para;</a></h4>
<p>To enable data reception on the RS485 bus, the DE/RE (Driver Enable / Receiver Enable) control pin must be set to a low level (0).
In this setup, the control pin corresponds to <code>GPIO27</code>.</p>
<p>Enable receive mode with the following command:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>./test/GATEBERRY_V9/GATEBERRY/set-digital-output<span class="w"> </span>DE_RE<span class="w"> </span><span class="m">0</span>
</span></code></pre></div></p>
<p>Once configured, incoming data can be viewed using:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>cat<span class="w"> </span>/dev/rs485
</span></code></pre></div></p>
<h4 id="3-Sending-Messages">3. Sending Messages<a class="headerlink" href="#3-Sending-Messages" title="Permanent link">&para;</a></h4>
<p>To transmit data over RS485, the DE/RE control pin must be set to a high level (1).
Use the following command to enable transmit mode:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>./test/GATEBERRY_V9/GATEBERRY/set-digital-output<span class="w"> </span>DE_RE<span class="w"> </span><span class="m">1</span>
</span></code></pre></div></p>
<p>You can then send data through the serial port as follows:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MSG&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/rs485
</span></code></pre></div></p>
<h4 id="4-Termination-Resistor-Configuration">4. Termination Resistor Configuration<a class="headerlink" href="#4-Termination-Resistor-Configuration" title="Permanent link">&para;</a></h4>
<p>The RS485 bus termination resistor can be controlled via <code>GPIO17</code> on the Raspberry Pi:</p>
<ul>
<li><strong>LOW</strong> = termination resistor disabled (default state)</li>
<li><strong>HIGH</strong> = termination resistor enabled (only activate if the PLC is at the end of the line)</li>
</ul>
<p>Check the current state of the termination resistor:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>pinctrl<span class="w"> </span>get<span class="w"> </span><span class="m">17</span>
</span></code></pre></div>
Set the termination resistor LOW (disabled):
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>pinctrl<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="m">17</span><span class="w"> </span>op<span class="w"> </span>dl
</span></code></pre></div>
Set the termination resistor HIGH (enabled):
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>pinctrl<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="m">17</span><span class="w"> </span>op<span class="w"> </span>dh
</span></code></pre></div></p>
<h4 id="5-Additional-Notes">5. Additional Notes<a class="headerlink" href="#5-Additional-Notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Ensure that all devices connected to the RS485 bus share the same baud rate and serial communication parameters (data bits, parity, and stop bits).</li>
<li>Proper control of the DE/RE line is essential to avoid bus collisions.</li>
<li>Only enable the termination resistor on the device located at the end of the RS485 line.</li>
<li>Correct termination and biasing resistors improve signal integrity on longer RS485 networks.</li>
</ul>
<!-- 
### Related blogs
[Send and receive data trough RS485 of UPSafePi](https://www.industrialshields.com/es_ES/blog/raspberry-pi-para-la-industria-26/send-and-receive-data-trough-rs485-of-upsafepi-565)

[How to use Modbus RTU with Touchberry Panel / UPSafePI](https://www.industrialshields.com//blog/raspberry-pi-for-industry-26/how-to-use-modbus-rtu-with-touchberry-panel-upsafepi-646)

[How to communicate a UPSafePi with an M-Duino PLC using RS485 protocol](https://www.industrialshields.com//blog/raspberry-pi-for-industry-26/how-to-communicate-a-upsafepi-with-an-m-duino-plc-using-rs485-protocol-576)
 -->

<h2 id="I²C">I²C<a class="headerlink" href="#I²C" title="Permanent link">&para;</a></h2>
<p>I²C (Inter-Integrated Circuit) is a serial communication protocol that allows multiple devices to communicate over just two wires—one for data and one for the clock. It’s commonly used for short-distance communication between microcontrollers and peripherals.</p>
<h3 id="Important-features-and-values-to-consider_1">Important features and values ​​to consider<a class="headerlink" href="#Important-features-and-values-to-consider_1" title="Permanent link">&para;</a></h3>
<table>
   <tr><td><b>Interface type</b></td><td>I²C</td></tr>
   <!-- <tr><td><b>Communication speed (baud rate)</b></td><td><a href="#1-Serial-Port-Configuration">Configurable</a></td></tr> -->
   <tr><td><b>Connectors and wiring</b></td><td>Push-in connectors (<b>SDA</b>(data) and <b>SCL</b>(clock))</td></tr>
   <tr><td><b>Signal voltage</b></td><td>5V (Pull-up resistors)</td></tr>
</table>

<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Remember that our GateBerry's I²C bus has a 5V pull-up, so do not connect devices that only support I²C at 3.3V.</p>
</div>
<h3 id="Connections_1">Connections<a class="headerlink" href="#Connections_1" title="Permanent link">&para;</a></h3>
<figure style="padding: 50px">
  <img alt="" src="../../assets/pinout-diagrams/gateberry_ps-gateberry-i2cbus.svg" width="70%" />
    <!-- <figcaption>Image caption</figcaption> -->
</figure>
<h3 id="Configurations_1">Configurations<a class="headerlink" href="#Configurations_1" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, it comes <strong>enabled</strong> with our image and includes the necessary tools for its use. Nevertheless, this is how it would be enabled and used.</p>
</div>
<h4 id="Enable-I²C">Enable I²C<a class="headerlink" href="#Enable-I²C" title="Permanent link">&para;</a></h4>
<ol>
<li>Run the following command to open the GateBerry configuration tool:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sudo<span class="w"> </span>raspi-config
</span></code></pre></div></li>
<li>Navigate to <strong>Interfacing Options &gt; I2C</strong> and select <strong>Yes</strong> to enable I²C.</li>
<li>Reboot the Raspberry Pi to apply the changes:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>sudo<span class="w"> </span>reboot
</span></code></pre></div></li>
</ol>
<h4 id="I²C-Tools">I²C Tools<a class="headerlink" href="#I²C-Tools" title="Permanent link">&para;</a></h4>
<p>To interact with I²C devices, it is also highly recommended to install the i2c-tools package (installed by default):</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>i2c-tools
</span></code></pre></div>
These tools allow us to scan devices connected to the I²C bus and verify their operation.</p>
<p>For example, before communicating with a device, it is useful to scan the I²C bus to detect the addresses of connected devices. 
Use the following command in the terminal:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>i2cdetect<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span>
</span></code></pre></div>
There are several other useful tools as well; here is a summary:</p>
<table>
<thead>
<tr>
<th style="text-align: center;"><strong>Command</strong></th>
<th style="text-align: center;"><strong>Description</strong></th>
<th style="text-align: center;"><strong>Basic Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>i2cdetect</code></td>
<td style="text-align: center;">Detects devices on the I²C bus</td>
<td style="text-align: center;"><code>i2cdetect -y 1</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>i2cdump</code></td>
<td style="text-align: center;">Displays the contents of registers</td>
<td style="text-align: center;"><code>i2cdump -y 1 0x23</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>i2cget</code></td>
<td style="text-align: center;">Reads a value from a register</td>
<td style="text-align: center;"><code>i2cget -y 1 0x23 0x00</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>i2cset</code></td>
<td style="text-align: center;">Writes a value to a register</td>
<td style="text-align: center;"><code>i2cset -y 1 0x23 0x01 0x80</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>i2ctransfer</code></td>
<td style="text-align: center;">Advanced read/write operations</td>
<td style="text-align: center;"><code>i2ctransfer -y 1 w1@0x23 0x00 r2</code></td>
</tr>
</tbody>
</table>
<!-- 
### Related blogs

[Interfacing Raspberry Pi and M-Duino via I2C communication](https://www.industrialshields.com//blog/arduino-raspberry-pi-industrial-news-industry-4-0-iot-11/interfacing-raspberry-pi-and-m-duino-via-i2c-communication-592)

[How to test the I2C communication protocol with Raspberry PLC](https://www.industrialshields.com//blog/raspberry-pi-for-industry-26/how-to-test-the-i2c-communication-protocol-with-raspberry-plc-529)

[How to test external I2C communication on Raspberry PLC](https://www.industrialshields.com//blog/raspberry-pi-for-industry-26/how-to-test-external-i2c-communication-on-raspberry-plc-354)
 -->

<h2 id="RTC">RTC<a class="headerlink" href="#RTC" title="Permanent link">&para;</a></h2>
<p>A Real-Time Clock (RTC) is an electronic device or integrated circuit that continuously keeps track of the current time and date, even when the main system is powered off, typically using a backup battery. It is widely used in computers, microcontrollers, and embedded systems to maintain accurate timekeeping.</p>
<p>The configurations for using our integrated RTC are located in the file: <code>/boot/firmware/config.txt</code>
and are as follows:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nv">dtparam</span><span class="o">=</span><span class="nv">i2c_arm</span><span class="o">=</span>on
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nv">dtoverlay</span><span class="o">=</span>i2c-rtc,pcf85363
</span></code></pre></div>
<p>Once the overlay is configured and the module is detected using the command <code>sudo i2cdetect -y 1</code>, it should appear at address 0x51. The operating system (OS) should recognize it as a hardware clock (hwclock).</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Reading the Hardware RTC Time</label><label for="__tabbed_1_2">Writing the System Time to the Hardware RTC</label><label for="__tabbed_1_3">Setting the System Time from the Hardware RTC</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Use the <code>hwclock</code> command with the hardware option (-r or --show):</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>sudo<span class="w"> </span>hwclock<span class="w"> </span>-r
</span></code></pre></div>
  This will display the current time stored in the RTC module's memory.</p>
</div>
<div class="tabbed-block">
<p>If the system time (the one normally displayed, set by the network/NTP) is correct and you want to save it to the RTC:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo<span class="w"> </span>hwclock<span class="w"> </span>-w
</span></code></pre></div>
  This overwrites the RTC time with the current Raspberry Pi system time. It is essential to perform this at least once to set the RTC’s initial time.</p>
</div>
<div class="tabbed-block">
<p>If the system has booted without network access and the time is incorrect, you can use the time stored in the RTC to set the system time:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>sudo<span class="w"> </span>hwclock<span class="w"> </span>-s
</span></code></pre></div>
  Typically, this step is performed automatically at Raspberry Pi startup if the overlay is configured correctly and the service that attempts to "save" unsynchronized time is disabled.</p>
</div>
</div>
</div>
<!-- 
### Related blogs
[How to set up the UPS of a Raspberry based PLC](https://www.industrialshields.com//blog/raspberry-pi-for-industry-26/ups-shield-with-rpi-plc-645)
 -->

<h2 id="UPS">UPS<a class="headerlink" href="#UPS" title="Permanent link">&para;</a></h2>
<p>Our UPS is a device that, thanks to its supercapacitors, can provide temporary electrical power to the GateBerry during a power outage or supply interruption. This ensures that ongoing processes can be safely completed and prevents memory corruption.</p>
<p>The unit comes preconfigured from the factory, with all necessary settings and services already set up.</p>
<p>The hardware configuration is done in: <code>/boot/firmware/config.txt</code></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nv">dtoverlay</span><span class="o">=</span>gpio-poweroff,gpiopin<span class="o">=</span><span class="m">23</span>,active_low
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nv">dtoverlay</span><span class="o">=</span>gpio-shutdown,gpio_pin<span class="o">=</span><span class="m">24</span>,gpio_pull<span class="o">=</span>up
</span></code></pre></div>
<h3 id="Pre-power-off-commands-safeguarding-your-data">Pre-power off commands: safeguarding your data<a class="headerlink" href="#Pre-power-off-commands-safeguarding-your-data" title="Permanent link">&para;</a></h3>
<p>Before shutting down the system, ensure that all critical operations are completed using the pre-shutdown hooks.</p>
<p>The configurations you will see below are already set by default. If you want to learn how to use them, proceed to the following step: <a href="#Usability-test">Usability test</a>.</p>
<h4 id="Configurations-default">Configurations (default)<a class="headerlink" href="#Configurations-default" title="Permanent link">&para;</a></h4>
<p>This guide provides detailed steps to configure directories, download the necessary service files, and set up scripts to automate crucial tasks before shutdown.</p>
<ol>
<li>
<p>Create the necessary directory (if no exists): Create the required directory to store the pre-poweroff hooks:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/rpishutdown/hooks
</span></code></pre></div></p>
</li>
<li>
<p>Download the service file and hook script: Fetch the required files for the pre-poweroff service and the check script:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>sudo<span class="w"> </span>curl<span class="w"> </span>-L<span class="w"> </span>https://apps.industrialshields.com/main/rpi_experimental/rpiplc/rpishutdown-pre-poweroff.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">     </span>-o<span class="w"> </span>/lib/systemd/system/rpishutdown-pre-poweroff.service
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>sudo<span class="w"> </span>curl<span class="w"> </span>-L<span class="w"> </span>https://apps.industrialshields.com/main/rpi_experimental/rpiplc/check-pre-poweroff-hook.sh<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">     </span>-o<span class="w"> </span>/etc/rpishutdown/hooks/check-pre-poweroff
</span></code></pre></div></p>
</li>
<li>
<p>Grant execution permissions: Make the pre-poweroff script executable:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>sudo<span class="w"> </span>chmod<span class="w"> </span>ugo+x<span class="w"> </span>/etc/rpishutdown/hooks/check-pre-poweroff
</span></code></pre></div></p>
</li>
<li>
<p>Enable and start the pre-poweroff service: Reload the systemd daemon and enable the new service:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>rpishutdown-pre-poweroff
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>rpishutdown-pre-poweroff
</span></code></pre></div></p>
</li>
</ol>
<h4 id="Usability-test">Usability test<a class="headerlink" href="#Usability-test" title="Permanent link">&para;</a></h4>
<p>As you may have seen earlier, there is a dedicated service that monitors for power outages. In such cases, it executes the file located at: <code>/etc/rpishutdown/hooks/pre-poweroff</code>.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Any type of file (Bash Scripts, Python, C++, etc.) can be executed, but the most important thing is that the file must be called <strong>pre-poweroff</strong> without any extension (and you must indicate the file type with the corresponding <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)"><strong>Shebang</strong></a>).</p>
</div>
<p>This setup ensures that any custom commands in the check-pre-poweroff script will be executed before the system powers off.</p>
<!-- 
### Related blogs
[How to set up the UPS of a Raspberry based PLC](https://www.industrialshields.com//blog/raspberry-pi-for-industry-26/ups-shield-with-rpi-plc-645)
 -->

<h2 id="Expansion-Boards">Expansion Boards<a class="headerlink" href="#Expansion-Boards" title="Permanent link">&para;</a></h2>
<p>The GateBerry includes <strong>one slot</strong> for additional communication.
Currently, it supports the following connection options:</p>
<div class="grid cards">
<ul>
<li>
<p><strong>Cellular networks technologies</strong></p>
<hr />
<!-- <figure markdown="span">
  <img alt="" src="../assets/altres/ltem-nbiot.png" />{ width="70%" }
</figure> -->
<p><a href="/gateberry/gateberry-expansion/#4G-LTE-CAT-M1--NB-IoT"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Getting started</a></p>
</li>
<li>
<p><strong>CAN</strong></p>
<hr />
<!-- <figure markdown="span">
  <img alt="" src="../assets/altres/CAN_Logo.svg" />{ width="70%" }
</figure> -->
<p><a href="/gateberry/gateberry-expansion/#CAN"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Getting started</a></p>
</li>
<li>
<p><strong>LoRa</strong> 
 <br />
<!-- -   LPWAN no cellular networks technologies --></p>
<hr />
<p><!-- <figure markdown="span">
  <img alt="" src="../assets/altres/iot-lora-alliance-logo.svg_.png" />{ width="50%" }
  </figure> -->
  <a href="/gateberry/gateberry-expansion/#LoRa"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Getting started</a></p>
</li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: GateBerry">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                GateBerry
              </div>
            </div>
          </a>
        
        
          
          <a href="../gateberry-expansion/" class="md-footer__link md-footer__link--next" aria-label="Next: Expansion Boards">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Expansion Boards
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["toggle.color-mode", "content.code.copy", "content.admonition.icons", "content.tabs.icons", "navigation.instant", "navigation.top", "navigation.footer", "navigation.indexes", "search.highlight", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../../custom/custom-js.js"></script>
      
    
  </body>
</html>